name: Mammam Daily Update

on:
  schedule:
    # 한국 시간으로 매일 새벽 00:01에 자동 실행 (UTC 15:01)
    - cron: '1 15 * * *'
  
  # 필요할 때 깃허브에서 버튼 눌러서 직접 실행하는 기능
  workflow_dispatch:
    inputs:
      target_id: # 파이썬 코드와 이름을 맞춰 'target_id'로 수정했습니다.
        description: '업데이트할 인스타 ID (입력 안 하면 신규/오래된 데이터 전체 업데이트)'
        required: false
        default: ''

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    # 구글 서비스 계정 키(Base64)를 파일로 복구
    - name: Create key file
      run: |
        echo "${{ secrets.GOOGLE_KEY_JSON }}" | base64 --decode > key.json
    
    # 크롤러 실행 (환경변수로 target_id를 넘겨줍니다)
    - name: Run Crawler
      env:
        TARGET_ID: ${{ github.event.inputs.target_id }}
      run: |
        python main.py
